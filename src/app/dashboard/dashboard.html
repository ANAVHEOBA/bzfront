<!-- src/app/dashboard/dashboard.html -->
<div class="dashboard-layout">
  <div class="dashboard-container">
    <header class="dashboard-header">
      <h1>Campaign Dashboard</h1>
      <button (click)="logout()" class="btn btn-logout">Logout</button>
    </header>

    @if (uploadSuccess) {
      <div class="notification success">Campaign uploaded successfully!</div>
    }
    @if (errorMessage) {
      <div class="notification error">{{ errorMessage }}</div>
    }

    <!-- Upload Form -->
    <div class="card upload-card">
      <h2 id="upload-form-title">{{ isEditing ? 'Edit Campaign' : 'Create New Campaign' }}</h2>
      <form (ngSubmit)="onSubmit()" class="upload-form">
        <div class="form-group">
          <label for="slug">Campaign Slug *</label>
          <input type="text" id="slug" [(ngModel)]="slug" name="slug" required
                 placeholder="e.g., summer-sale-2024" [disabled]="isEditing">
        </div>

        <div class="form-group">
          <label for="waLink">WhatsApp Link *</label>
          <input type="url" id="waLink" [(ngModel)]="waLink" name="waLink" required
                 placeholder="https://wa.me/1234567890">
        </div>

        <div class="form-group">
          <label for="waButtonLabel">WhatsApp Button Text *</label>
          <input type="text" id="waButtonLabel" [(ngModel)]="waButtonLabel"
                 name="waButtonLabel" required placeholder="e.g., Order on WhatsApp">
        </div>

        <div class="form-group">
          <label for="caption">Caption *</label>
          <textarea id="caption" [(ngModel)]="caption" name="caption" required
                    rows="3" placeholder="Enter campaign description..."></textarea>
        </div>

        <!-- NEW: Popup Timing -->
        <div class="form-group">
          <label for="popupTriggerType">Popup Trigger</label>
          <select id="popupTriggerType" [(ngModel)]="popupTriggerType" name="popupTriggerType">
            <option [ngValue]="null">— None —</option>
            <option value="seconds">After seconds</option>
            <option value="percent">At % of video</option>
          </select>
        </div>

        @if (popupTriggerType) {
          <div class="form-group">
            <label for="popupTriggerValue">
              {{ popupTriggerType === 'seconds' ? 'Seconds' : 'Percent (0-100)' }}
            </label>
            <input type="number" id="popupTriggerValue"
                   [(ngModel)]="popupTriggerValue" name="popupTriggerValue"
                   min="0"
                   [max]="popupTriggerType === 'percent' ? 100 : 9999"
                   placeholder="e.g., 8">
          </div>
        }

        <!-- File Uploads -->
        <div class="file-upload-group">
          <div class="file-upload">
            <label>Preview Image / Video (Small) *</label>
            <input type="file" accept="image/*,video/*"
                   (change)="onFileSelected($event, 'preview')" [disabled]="isUploading">
            <span class="file-name">{{ previewFile?.name || (isEditing && previewUrl ? 'Existing File' : 'No file selected') }}</span>
            @if (previewUrl && (!previewFile || isEditing)) {
              <div class="image-preview">
                <img [src]="previewUrl" alt="Preview">
              </div>
            }
          </div>

          <div class="file-upload">
            <label>Full Resolution Image / Video *</label>
            <input type="file" accept="image/*,video/*"
                   (change)="onFileSelected($event, 'full')" [disabled]="isUploading">
            <span class="file-name">{{ fullFile?.name || (isEditing && fullUrl ? 'Existing File' : 'No file selected') }}</span>
            @if (fullUrl && (!fullFile || isEditing)) {
              <div class="image-preview">
                <img [src]="fullUrl" alt="Full">
              </div>
            }
          </div>
        </div>

        @if (isEditing) {
          <div class="edit-buttons">
            <button type="submit" class="btn btn-primary" [disabled]="isUploading">
              @if (isUploading) {
                <span class="spinner"></span> Updating...
              } @else {
                Update Campaign
              }
            </button>
            <button type="button" class="btn btn-secondary" (click)="cancelEdit()" [disabled]="isUploading">
              Cancel
            </button>
          </div>
        } @else {
          <button type="submit" class="btn btn-primary" [disabled]="isUploading">
            @if (isUploading) {
              <span class="spinner"></span> Uploading...
            } @else {
              Upload Campaign
            }
          </button>
        }
      </form>
    </div>

    <!-- Recent Campaigns -->
    <div class="card">
      <h2>Recent Campaigns</h2>
      @if (campaigns.length) {
        <div class="campaign-grid">
          @for (c of campaigns; track c.slug) {
            <div class="campaign-item">
              <a [routerLink]="['/campaigns', c.slug]">
                <img [src]="c.fullThumbnailUrl" [alt]="c.slug" loading="lazy" />
              </a>
              <p>{{ c.slug }}</p>
              <div class="campaign-actions">
                <button class="btn btn-secondary btn-sm" (click)="editCampaign(c)">Edit</button>
                <button class="btn btn-danger btn-sm" (click)="deleteCampaign(c.slug)">Delete</button>
              </div>
            </div>
          }
        </div>
      } @else {
        <p class="empty-state">No campaigns uploaded yet</p>
      }
    </div>
  </div>
</div>